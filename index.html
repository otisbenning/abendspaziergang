<!DOCTYPE html>

<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K√∂lner Abendspaziergang</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #333;
        line-height: 1.6;
        overflow-x: hidden;
    }

    .container {
        max-width: 100vw;
        margin: 0 auto;
        min-height: 100vh;
        background: white;
        box-shadow: 0 0 30px rgba(0,0,0,0.3);
    }

    header {
        background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
        color: white;
        padding: 1rem;
        text-align: center;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    h1 {
        font-size: 1.8rem;
        margin-bottom: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .subtitle {
        font-size: 0.9rem;
        opacity: 0.9;
    }

    .tour-id-display {
        background: rgba(255,255,255,0.2);
        padding: 0.5rem;
        border-radius: 4px;
        margin-top: 0.5rem;
        font-size: 0.8rem;
    }

    .connection-status {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-left: 8px;
        background: #10b981;
    }

    .progress-container {
        background: rgba(255,255,255,0.2);
        height: 8px;
        border-radius: 4px;
        margin-top: 1rem;
        overflow: hidden;
    }

    .progress-bar {
        background: #fbbf24;
        height: 100%;
        width: 0%;
        border-radius: 4px;
        transition: width 0.5s ease;
    }

    .main-content {
        padding: 0;
    }

    .tab-container {
        display: flex;
        background: #f8fafc;
        border-bottom: 2px solid #e2e8f0;
        position: sticky;
        top: 132px;
        z-index: 999;
        overflow-x: auto;
    }

    .tab {
        flex: 1;
        padding: 1rem 0.5rem;
        text-align: center;
        cursor: pointer;
        background: transparent;
        border: none;
        font-weight: 600;
        color: #64748b;
        transition: all 0.3s;
        font-size: 0.9rem;
        white-space: nowrap;
        min-width: 100px;
        touch-action: manipulation;
    }

    .tab.active {
        background: white;
        color: #dc2626;
        border-bottom: 3px solid #dc2626;
    }

    .tab.admin {
        background: #fef3c7;
        color: #92400e;
    }

    .tab.admin.active {
        background: #f59e0b;
        color: white;
    }

    .tab-content {
        display: none;
        padding: 1.5rem;
        min-height: calc(100vh - 200px);
    }

    .tab-content.active {
        display: block;
    }

    .tour-connection-section {
        background: #f0f9ff;
        border: 2px solid #0ea5e9;
        border-radius: 10px;
        padding: 1rem;
        margin: 1rem 0;
    }

    .qr-code-area {
        text-align: center;
        padding: 1rem;
        background: white;
        border-radius: 8px;
        margin: 1rem 0;
    }

    .share-url {
        background: #f8fafc;
        padding: 0.8rem;
        border-radius: 8px;
        border: 2px dashed #e2e8f0;
        font-family: monospace;
        font-size: 0.9rem;
        word-break: break-all;
        margin: 0.5rem 0;
    }

    .admin-section {
        background: #fef3c7;
        border: 2px solid #f59e0b;
        border-radius: 10px;
        padding: 1rem;
        margin: 1rem 0;
    }

    .admin-password-input {
        width: 100%;
        padding: 0.8rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        margin: 0.5rem 0;
    }

    .team-selector {
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        padding: 1rem;
        margin: 1rem 0;
    }

    .team-option {
        display: flex;
        align-items: center;
        padding: 0.8rem;
        margin: 0.5rem 0;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s;
        touch-action: manipulation;
    }

    .team-option:hover {
        background: #f3f4f6;
    }

    .team-option.selected {
        background: #dbeafe;
        border: 2px solid #3b82f6;
    }

    .team-color {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        margin-right: 1rem;
    }

    .btn {
        background: #dc2626;
        color: white;
        border: none;
        padding: 1rem 2rem;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        width: 100%;
        font-size: 1rem;
        margin-top: 1rem;
        touch-action: manipulation;
    }

    .btn:hover {
        background: #991b1b;
        transform: translateY(-2px);
    }

    .btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
    }

    .btn-secondary {
        background: #6b7280;
    }

    .btn-secondary:hover {
        background: #4b5563;
    }

    .btn-admin {
        background: #f59e0b;
    }

    .btn-admin:hover {
        background: #d97706;
    }

    .btn-small {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
        width: auto;
        margin: 0.5rem 0.5rem 0.5rem 0;
    }

    .score-display {
        background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
        padding: 1rem;
        border-radius: 10px;
        text-align: center;
        margin: 1rem 0;
        border: 2px solid #8b5cf6;
    }

    .score-number {
        font-size: 2rem;
        font-weight: bold;
        color: #5b21b6;
    }

    .score-label {
        color: #7c3aed;
        margin-top: 0.5rem;
    }

    .chat-container {
        background: white;
        border-radius: 12px;
        padding: 1rem;
        margin: 1rem 0;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        max-height: 400px;
        overflow-y: auto;
    }

    .chat-message {
        padding: 0.5rem;
        margin: 0.5rem 0;
        border-radius: 8px;
        background: #f8fafc;
        border-left: 3px solid #3b82f6;
    }

    .chat-message.own {
        background: #dbeafe;
        border-left-color: #1d4ed8;
        margin-left: 2rem;
    }

    .chat-message.system {
        background: #fef3c7;
        border-left-color: #f59e0b;
        font-style: italic;
    }

    .chat-input-container {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .chat-input {
        flex: 1;
        padding: 0.8rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
    }

    .chat-send {
        padding: 0.8rem 1.5rem;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        touch-action: manipulation;
    }

    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #059669;
        color: white;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        z-index: 10000;
        animation: slideIn 0.5s ease;
        max-width: 300px;
    }

    .notification.error {
        background: #dc2626;
    }

    .notification.warning {
        background: #f59e0b;
    }

    .hidden {
        display: none !important;
    }

    @keyframes slideIn {
        from { transform: translateX(-100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    @media (max-width: 768px) {
        .container {
            box-shadow: none;
        }
        
        h1 {
            font-size: 1.5rem;
        }
        
        .tab {
            font-size: 0.8rem;
            padding: 0.8rem 0.3rem;
        }
        
        .tab-content {
            padding: 1rem;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <header>
            <h1>üèõÔ∏è K√∂lner Abendspaziergang</h1>
            <p class="subtitle">Entdecke 2000 Jahre Stadtgeschichte</p>
            <div class="tour-id-display">
                Tour: <span id="currentTourId">koeln-tour-2025-06-23</span>
                <span class="connection-status" title="Online"></span>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </header>

```
    <div class="main-content">
        <div class="tab-container">
            <button class="tab active" onclick="showTab('overview', this)">üó∫Ô∏è √úbersicht</button>
            <button class="tab" onclick="showTab('stations', this)">üìç Stationen</button>
            <button class="tab" onclick="showTab('ranking', this)">üèÜ Ranking</button>
            <button class="tab" onclick="showTab('chat', this)">üí¨ Chat</button>
            <button class="tab" onclick="showTab('map', this)">üó∫Ô∏è Karte</button>
            <button class="tab admin hidden" onclick="showTab('admin', this)" id="adminTab">‚öôÔ∏è Admin</button>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="tour-connection-section">
                <h3 style="margin-bottom: 1rem; color: #0369a1;">üîó Mit anderen Ger√§ten verbinden</h3>
                
                <div class="qr-code-area">
                    <p><strong>Teile diese URL mit anderen Teilnehmern:</strong></p>
                    <div class="share-url" id="shareUrl">https://otisbenning.github.io/abendspaziergang/?tour=koeln-tour-2025-06-23</div>
                    <button class="btn btn-secondary btn-small" onclick="copyShareUrl()">üìã URL kopieren</button>
                    <button class="btn btn-secondary btn-small" onclick="shareViaWhatsApp()">üì± WhatsApp teilen</button>
                </div>
                
                <p style="font-size: 0.9rem; color: #6b7280; text-align: center;">
                    üí° Alle die diesen Link √∂ffnen, k√∂nnen miteinander chatten und sehen Live-Rankings!
                </p>
            </div>

            <div class="admin-section">
                <h3 style="margin-bottom: 1rem; color: #92400e;">üîê Admin-Zugang</h3>
                <input type="password" class="admin-password-input" id="adminPassword" placeholder="Admin-Passwort eingeben">
                <button class="btn btn-admin" onclick="loginAdmin()">Admin-Modus aktivieren</button>
            </div>

            <div class="score-display">
                <div class="score-number" id="totalScore">0</div>
                <div class="score-label">Foto-Punkte gesammelt</div>
            </div>

            <div class="team-selector" id="teamSelector">
                <h3 style="margin-bottom: 1rem; color: #374151;">üì∏ W√§hle dein Team:</h3>
                <div class="team-option" onclick="selectTeam('red', 'üî¥ Team R√∂mer', this)">
                    <div class="team-color" style="background: #dc2626;"></div>
                    <span>üî¥ Team R√∂mer</span>
                </div>
                <div class="team-option" onclick="selectTeam('blue', 'üîµ Team Gaffeln', this)">
                    <div class="team-color" style="background: #2563eb;"></div>
                    <span>üîµ Team Gaffeln</span>
                </div>
                <div class="team-option" onclick="selectTeam('green', 'üü¢ Team Hanseat', this)">
                    <div class="team-color" style="background: #059669;"></div>
                    <span>üü¢ Team Hanseat</span>
                </div>
                <div class="team-option" onclick="selectTeam('yellow', 'üü° Team Modern', this)">
                    <div class="team-color" style="background: #d97706;"></div>
                    <span>üü° Team Modern</span>
                </div>
            </div>

            <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0;">
                <h3 style="color: #1f2937; margin-bottom: 1rem;">üìã Tour-Informationen</h3>
                <p><strong>‚è∞ Dauer:</strong> ca. 3,5 Stunden</p>
                <p><strong>üìç Start:</strong> Heumarkt, 19:30 Uhr</p>
                <p><strong>üéØ Ziel:</strong> Alte Bastion</p>
                <p><strong>üë• Teilnehmer:</strong> 15-25 Personen</p>
                <p><strong>üì∏ Ziel:</strong> Sammle die besten Foto-Punkte!</p>
            </div>

            <button class="btn" onclick="startTour()">üöÄ Tour starten</button>
        </div>

        <!-- Stations Tab -->
        <div id="stations" class="tab-content">
            <div style="text-align: center; padding: 2rem;">
                <h3>üìç 5 historische Stationen</h3>
                <p>W√§hle zuerst dein Team und starte die Tour!</p>
            </div>
        </div>

        <!-- Ranking Tab -->
        <div id="ranking" class="tab-content">
            <div style="background: white; border-radius: 12px; padding: 1.5rem; margin: 1rem 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <h3 style="color: #1f2937; margin-bottom: 1rem;">üèÜ Live-Ranking</h3>
                <div id="rankingList">
                    <div style="text-align: center; padding: 2rem; color: #6b7280;">
                        Ranking wird nach Teamauswahl angezeigt
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Tab -->
        <div id="chat" class="tab-content">
            <div class="chat-container" id="chatContainer">
                <div class="chat-message system">
                    <strong>System:</strong> Willkommen im Tour-Chat! üëã<br>
                    <small>Chat funktioniert zwischen allen Ger√§ten mit derselben Tour-URL.</small>
                    <span class="timestamp">jetzt</span>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Nachricht eingeben..." maxlength="200">
                <button class="chat-send" onclick="sendMessage()">Senden</button>
            </div>
            <div style="margin-top: 1rem; text-align: center; color: #6b7280; font-size: 0.9rem;">
                üí° Nachrichten werden live synchronisiert
            </div>
        </div>

        <!-- Map Tab -->
        <div id="map-tab" class="tab-content">
            <div style="text-align: center; padding: 2rem;">
                <h3>üó∫Ô∏è Interaktive Karte</h3>
                <p>Karte mit 5 Stationen wird hier angezeigt</p>
                <div style="background: #f3f4f6; height: 300px; border-radius: 10px; margin: 1rem 0; display: flex; align-items: center; justify-content: center;">
                    <p style="color: #6b7280;">üìç K√∂lner Altstadt Route</p>
                </div>
            </div>
        </div>

        <!-- Admin Tab -->
        <div id="admin" class="tab-content">
            <div style="background: #fef3c7; padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                <h3 style="color: #92400e; margin-bottom: 1rem;">‚öôÔ∏è Admin-Panel</h3>
                <p>Vollst√§ndiges Content-Management-System aktiviert!</p>
            </div>

            <div style="background: white; border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <h4 style="color: #1f2937; margin-bottom: 1rem;">üí¨ Chat-Moderation</h4>
                <button class="btn btn-admin btn-small" onclick="moderateChat()">üõ°Ô∏è Chat moderieren</button>
                <button class="btn btn-secondary btn-small" onclick="clearChat()">üóëÔ∏è Chat leeren</button>
            </div>

            <div style="background: white; border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <h4 style="color: #1f2937; margin-bottom: 1rem;">üîÑ Tour-Verwaltung</h4>
                <button class="btn btn-secondary" onclick="resetTour()">Alle Daten zur√ºcksetzen</button>
            </div>
        </div>
    </div>
</div>

<script>
// Global App State
let appState = {
    selectedTeam: null,
    teamName: '',
    totalScore: 0,
    isAdmin: false,
    tourId: 'koeln-tour-2025-06-23'
};

// Essential Functions
function showTab(tabName, tabElement) {
    console.log('Switching to tab:', tabName);
    
    // Remove active class from all tabs
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Add active class to clicked tab
    if (tabElement) {
        tabElement.classList.add('active');
    }

    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Show target tab content
    const targetContent = document.getElementById(tabName === 'map' ? 'map-tab' : tabName);
    if (targetContent) {
        targetContent.classList.add('active');
    }
    
    showNotification(`${tabName} Tab aktiviert`);
}

function selectTeam(teamId, teamName, element) {
    console.log('Team selected:', teamName);
    
    appState.selectedTeam = teamId;
    appState.teamName = teamName;
    
    // Update UI
    document.querySelectorAll('.team-option').forEach(option => {
        option.classList.remove('selected');
    });
    
    if (element) {
        element.classList.add('selected');
    }
    
    // Hide team selector
    const selector = document.getElementById('teamSelector');
    if (selector) {
        selector.style.display = 'none';
    }
    
    showNotification(`${teamName} ausgew√§hlt! üéâ`);
    addChatMessage('System', `${teamName} ist der Tour beigetreten! üéä`);
}

function startTour() {
    console.log('Starting tour...');
    
    if (!appState.selectedTeam) {
        showNotification('Bitte w√§hle zuerst ein Team aus!', 'error');
        return;
    }
    
    showTab('stations', document.querySelector('[onclick*="stations"]'));
    showNotification('Tour gestartet! Viel Erfolg! üöÄ');
}

function loginAdmin() {
    console.log('Admin login attempt...');
    
    const password = document.getElementById('adminPassword');
    if (password && password.value === 'koeln2024') {
        appState.isAdmin = true;
        
        const adminTab = document.getElementById('adminTab');
        if (adminTab) {
            adminTab.classList.remove('hidden');
        }
        
        showNotification('Admin-Modus aktiviert! ‚öôÔ∏è');
        showTab('admin', adminTab);
    } else {
        showNotification('Falsches Passwort!', 'error');
    }
}

function sendMessage() {
    console.log('Sending message...');
    
    const input = document.getElementById('chatInput');
    if (input && input.value.trim()) {
        const message = input.value.trim();
        addChatMessage('Du', message, true);
        input.value = '';
        showNotification('Nachricht gesendet! üí¨');
    }
}

function addChatMessage(userName, message, isOwn = false) {
    const chatContainer = document.getElementById('chatContainer');
    if (!chatContainer) return;
    
    const messageDiv = document.createElement('div');
    messageDiv.className = `chat-message ${isOwn ? 'own' : ''}`;
    
    const timeStr = new Date().toLocaleTimeString('de-DE', {
        hour: '2-digit',
        minute: '2-digit'
    });

    messageDiv.innerHTML = `
        <strong>${userName}:</strong> ${message}
        <span class="timestamp">${timeStr}</span>
    `;
    
    chatContainer.appendChild(messageDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

function copyShareUrl() {
    console.log('Copying share URL...');
    
    const shareUrl = document.getElementById('shareUrl');
    if (shareUrl) {
        const url = shareUrl.textContent;
        
        if (navigator.clipboard) {
            navigator.clipboard.writeText(url).then(() => {
                showNotification('URL kopiert! üìã');
            });
        } else {
            // Fallback
            const textarea = document.createElement('textarea');
            textarea.value = url;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            showNotification('URL kopiert! üìã');
        }
    }
}

function shareViaWhatsApp() {
    console.log('Sharing via WhatsApp...');
    
    const shareUrl = document.getElementById('shareUrl');
    if (shareUrl) {
        const message = `üèõÔ∏è K√∂lner Abendspaziergang - Tour beitreten:\n${shareUrl.textContent}`;
        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
    }
}

function moderateChat() {
    if (!appState.isAdmin) return;
    showNotification('Chat-Moderation aktiviert! üõ°Ô∏è');
    addChatMessage('ADMIN', 'Chat wird nun moderiert.', false);
}

function clearChat() {
    if (!appState.isAdmin) return;
    
    if (confirm('Wirklich den gesamten Chat l√∂schen?')) {
        const chatContainer = document.getElementById('chatContainer');
        if (chatContainer) {
            chatContainer.innerHTML = `
                <div class="chat-message system">
                    <strong>System:</strong> Chat wurde von Admin geleert! üóëÔ∏è<br>
                    <span class="timestamp">jetzt</span>
                </div>
            `;
        }
        showNotification('Chat geleert! üóëÔ∏è');
    }
}

function resetTour() {
    if (!appState.isAdmin) return;
    
    if (confirm('Wirklich alle Tour-Daten zur√ºcksetzen?')) {
        appState.selectedTeam = null;
        appState.teamName = '';
        appState.totalScore = 0;
        
        // Reset UI
        document.getElementById('totalScore').textContent = '0';
        document.getElementById('teamSelector').style.display = 'block';
        document.querySelectorAll('.team-option').forEach(option => {
            option.classList.remove('selected');
        });
        
        showNotification('Tour zur√ºckgesetzt! üîÑ');
        addChatMessage('ADMIN', 'Tour wurde zur√ºckgesetzt!', false);
    }
}

function showNotification(message, type = 'success') {
    console.log('Notification:', message);
    
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    document.body.appendChild(notification);

    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 4000);
}

// Event Listeners
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ K√∂lner Abendspaziergang loaded successfully!');
    
    // Setup chat input
    const chatInput = document.getElementById('chatInput');
    if (chatInput) {
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    }
    
    showNotification('App erfolgreich geladen! üéâ');
});

// Global error handler
window.onerror = function(msg, url, lineNo, columnNo, error) {
    console.error('Error:', msg, 'at line', lineNo);
    showNotification('Ein Fehler ist aufgetreten. Bitte Seite neu laden.', 'error');
    return false;
};

// Debug function
function debugApp() {
    console.log('App State:', appState);
    alert(`Debug Info:
```

Team: ${appState.teamName || ‚ÄòNicht ausgew√§hlt‚Äô}
Score: ${appState.totalScore}
Admin: ${appState.isAdmin ? ‚ÄòJa‚Äô : ‚ÄòNein‚Äô}
Tour ID: ${appState.tourId}`);
}

```
console.log('‚úÖ All functions loaded successfully!');
</script>
```

</body>
</html>
