<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K√∂lner Abendspaziergang</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 100vw;
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.3);
        }

        header {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .tour-id-display {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem;
            border-radius: 4px;
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }

        .progress-container {
            background: rgba(255,255,255,0.2);
            height: 8px;
            border-radius: 4px;
            margin-top: 1rem;
            overflow: hidden;
        }

        .progress-bar {
            background: #fbbf24;
            height: 100%;
            width: 0%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .main-content {
            padding: 0;
        }

        .tab-container {
            display: flex;
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
            position: sticky;
            top: 110px;
            z-index: 999;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 1rem 0.5rem;
            text-align: center;
            cursor: pointer;
            background: transparent;
            border: none;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s;
            font-size: 0.9rem;
            white-space: nowrap;
            min-width: 100px;
            touch-action: manipulation;
        }

        .tab.active {
            background: white;
            color: #dc2626;
            border-bottom: 3px solid #dc2626;
        }

        .tab-content {
            display: none;
            padding: 1.5rem;
            min-height: calc(100vh - 200px);
        }

        .tab-content.active {
            display: block;
        }

        .connection-section {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .share-url {
            background: #f8fafc;
            padding: 0.8rem;
            border-radius: 8px;
            border: 2px dashed #e2e8f0;
            font-family: monospace;
            font-size: 0.9rem;
            word-break: break-all;
            margin: 0.5rem 0;
        }

        .station-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #dc2626;
            cursor: pointer;
            transition: all 0.3s;
        }

        .station-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .station-card.completed {
            border-left-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }

        .station-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .station-number {
            background: #dc2626;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .station-number.completed {
            background: #10b981;
        }

        .station-title {
            flex: 1;
            font-size: 1.3rem;
            font-weight: bold;
            color: #1f2937;
        }

        .station-subtitle {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .station-details {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #e5e7eb;
        }

        .station-details.active {
            display: block;
        }

        .detail-section {
            margin-bottom: 1.5rem;
        }

        .detail-section h4 {
            color: #dc2626;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .detail-section h4::before {
            content: "‚ñ∂";
            margin-right: 0.5rem;
            color: #dc2626;
        }

        .photo-challenge {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid #6366f1;
        }

        .photo-challenge h4 {
            color: #4f46e5;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .photo-upload-area {
            border: 3px dashed #a5b4fc;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            margin: 1rem 0;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255,255,255,0.5);
            touch-action: manipulation;
        }

        .photo-upload-area:hover {
            border-color: #6366f1;
            background: rgba(255,255,255,0.8);
        }

        .photo-upload-area.has-photo {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .photo-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .ai-rating {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
            border: 2px solid #10b981;
        }

        .rating-score {
            font-size: 3rem;
            font-weight: bold;
            color: #059669;
            margin-bottom: 0.5rem;
        }

        .rating-text {
            color: #047857;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .rating-details {
            background: #f0fdf4;
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #065f46;
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .gallery-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .gallery-image:hover {
            transform: scale(1.05);
        }

        .gallery-item {
            text-align: center;
        }

        .gallery-item small {
            display: block;
            margin-top: 0.5rem;
            color: #6b7280;
            font-size: 0.8rem;
        }

        .btn {
            background: #dc2626;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            font-size: 1rem;
            margin-top: 1rem;
            touch-action: manipulation;
        }

        .btn:hover {
            background: #991b1b;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            width: auto;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }

        .score-display {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            margin: 1rem 0;
            border: 2px solid #8b5cf6;
        }

        .score-number {
            font-size: 2rem;
            font-weight: bold;
            color: #5b21b6;
        }

        .score-label {
            color: #7c3aed;
            margin-top: 0.5rem;
        }

        .team-ranking {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .team-rank-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            background: #f8fafc;
        }

        .team-rank-item.highlight {
            background: #fef3c7;
            border: 2px solid #f59e0b;
        }

        .rank-position {
            background: #6b7280;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
        }

        .rank-position.gold {
            background: #f59e0b;
        }

        .rank-position.silver {
            background: #6b7280;
        }

        .rank-position.bronze {
            background: #d97706;
        }

        .team-selector {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .team-option {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
            touch-action: manipulation;
        }

        .team-option:hover {
            background: #f3f4f6;
        }

        .team-option.selected {
            background: #dbeafe;
            border: 2px solid #3b82f6;
        }

        .team-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 1rem;
        }

        .chat-container {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-height: 400px;
            overflow-y: auto;
        }

        .chat-message {
            padding: 0.5rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            background: #f8fafc;
            border-left: 3px solid #3b82f6;
        }

        .chat-message.own {
            background: #dbeafe;
            border-left-color: #1d4ed8;
            margin-left: 2rem;
        }

        .chat-input-container {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.8rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
        }

        .chat-send {
            padding: 0.8rem 1.5rem;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            touch-action: manipulation;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #059669;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            animation: slideIn 0.5s ease;
            max-width: 300px;
        }

        .notification.error {
            background: #dc2626;
        }

        .hidden {
            display: none !important;
        }

        .file-input {
            display: none;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .container {
                box-shadow: none;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .tab {
                font-size: 0.8rem;
                padding: 0.8rem 0.3rem;
            }
            
            .tab-content {
                padding: 1rem;
            }
            
            .station-card {
                padding: 1rem;
            }
            
            .image-gallery {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèõÔ∏è K√∂lner Abendspaziergang</h1>
            <p class="subtitle">Entdecke 2000 Jahre Stadtgeschichte</p>
            <div class="tour-id-display">
                Tour: <span id="currentTourId">koeln-simple</span>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </header>

        <div class="main-content">
            <div class="tab-container">
                <button class="tab active" onclick="showTab('overview')">üó∫Ô∏è √úbersicht</button>
                <button class="tab" onclick="showTab('stations')">üìç Stationen</button>
                <button class="tab" onclick="showTab('ranking')">üèÜ Ranking</button>
                <button class="tab" onclick="showTab('chat')">üí¨ Chat</button>
            </div>

            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="connection-section">
                    <h3 style="margin-bottom: 1rem; color: #0369a1;">üîó Mit anderen verbinden</h3>
                    <p><strong>Teile diese URL:</strong></p>
                    <div class="share-url" id="shareUrl">L√§dt...</div>
                    <button class="btn btn-secondary btn-small" onclick="copyUrl()">üìã URL kopieren</button>
                    <p style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem;">
                        üí° Wer diesen Link √∂ffnet, kann mitchatten!
                    </p>
                </div>

                <div class="score-display">
                    <div class="score-number" id="totalScore">0</div>
                    <div class="score-label">Foto-Punkte gesammelt</div>
                </div>

                <div class="team-selector" id="teamSelector">
                    <h3 style="margin-bottom: 1rem; color: #374151;">üì∏ W√§hle dein Team:</h3>
                    <div class="team-option" onclick="selectTeam('red', 'üî¥ Team R√∂mer', this)">
                        <div class="team-color" style="background: #dc2626;"></div>
                        <span>üî¥ Team R√∂mer</span>
                    </div>
                    <div class="team-option" onclick="selectTeam('blue', 'üîµ Team Gaffeln', this)">
                        <div class="team-color" style="background: #2563eb;"></div>
                        <span>üîµ Team Gaffeln</span>
                    </div>
                    <div class="team-option" onclick="selectTeam('green', 'üü¢ Team Hanseat', this)">
                        <div class="team-color" style="background: #059669;"></div>
                        <span>üü¢ Team Hanseat</span>
                    </div>
                    <div class="team-option" onclick="selectTeam('yellow', 'üü° Team Modern', this)">
                        <div class="team-color" style="background: #d97706;"></div>
                        <span>üü° Team Modern</span>
                    </div>
                </div>

                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0;">
                    <h3 style="color: #1f2937; margin-bottom: 1rem;">üìã Tour-Informationen</h3>
                    <p><strong>‚è∞ Dauer:</strong> ca. 3,5 Stunden</p>
                    <p><strong>üìç Start:</strong> Heumarkt, 19:30 Uhr</p>
                    <p><strong>üéØ Ziel:</strong> Alte Bastion</p>
                    <p><strong>üë• Teilnehmer:</strong> 15-25 Personen</p>
                    <p><strong>üì∏ Ziel:</strong> Sammle die besten Foto-Punkte!</p>
                </div>

                <button class="btn" onclick="startTour()">üöÄ Tour starten</button>
            </div>

            <!-- Stations Tab -->
            <div id="stations" class="tab-content">
                <div id="stationsList">
                    <!-- Will be generated by JavaScript -->
                </div>
            </div>

            <!-- Ranking Tab -->
            <div id="ranking" class="tab-content">
                <div class="team-ranking">
                    <h3 style="color: #1f2937; margin-bottom: 1rem;">üèÜ Live-Ranking</h3>
                    <div id="rankingList">
                        <!-- Will be generated by JavaScript -->
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="color: #1f2937; margin-bottom: 1rem;">üì∏ KI-Punktesystem</h3>
                    <ul style="margin-left: 1.5rem; color: #4b5563;">
                        <li><strong>Technische Qualit√§t:</strong> Sch√§rfe, Belichtung, Komposition (0-40 Punkte)</li>
                        <li><strong>Kreativit√§t:</strong> Perspective, Originalit√§t (0-30 Punkte)</li>
                        <li><strong>Stadtbezug:</strong> Erkannte Sehensw√ºrdigkeiten (0-20 Punkte)</li>
                        <li><strong>Personen/Gruppenfoto:</strong> Bonus f√ºr Teamarbeit (+10 Punkte)</li>
                    </ul>
                </div>
            </div>

            <!-- Chat Tab -->
            <div id="chat" class="tab-content">
                <div class="chat-container" id="chatContainer">
                    <div class="chat-message">
                        <strong>System:</strong> Willkommen im Tour-Chat! üëã
                        <span style="float: right; font-size: 0.8rem;">jetzt</span>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Nachricht eingeben..." maxlength="200">
                    <button class="chat-send" onclick="sendMessage()">Senden</button>
                </div>
                <div style="margin-top: 1rem; text-align: center; color: #6b7280; font-size: 0.9rem;">
                    üí° Nachrichten werden zwischen Ger√§ten mit derselben URL geteilt
                </div>
            </div>
        </div>
    </div>

    <script>
    // Ultra-Simple JavaScript - No complex structures
    
    // Global state
    let appData = {
        selectedTeam: null,
        teamName: '',
        totalScore: 0,
        completedStations: [],
        userName: 'Tourist_' + Math.random().toString(36).substr(2, 5),
        tourId: 'koeln-simple'
    };

    // Station data
    const stations = [
        {
            id: 1,
            title: "Heumarkt",
            subtitle: "Wo alles anfing: 2000 Jahre Migration und Handel",
            photoChallenge: "Mache ein Foto von dir oder deinem Team vor dem Reiterstandbild - zeigt dabei mit Handbewegungen, wie H√§ndler fr√ºher ihre Waren angepriesen haben k√∂nnten!",
            mainText: "Die Stadt ist ca. 2.000 Jahre alt. CCAA - Colonia Claudia Ara Agrippinensium - wurde 50 n. Chr. von den R√∂mern gegr√ºndet, mithilfe der germanischen Ubier. Das war √ºbrigens eine der ersten erfolgreichen Integration zweier Kulturen in Europa.",
            images: [
                { url: "https://images.unsplash.com/photo-1568667256549-094345857637?w=400", title: "Heumarkt heute" },
                { url: "https://images.unsplash.com/photo-1590736969955-71cc94901144?w=400", title: "K√∂lner Architektur" }
            ]
        },
        {
            id: 2,
            title: "K√∂lner Dom",
            subtitle: "Das ewige Bauprojekt und die Verkehrsrevolution",
            photoChallenge: "Bildet mit eurem Team eine 'menschliche Kathedrale' vor dem Dom - streckt die Arme hoch und formt gotische B√∂gen nach!",
            mainText: "Der Dom wird seit fast 800 Jahren gebaut - etwas l√§nger als der BER. Die Grundsteinlegung 1248 war K√∂lns Versuch, Paris und andere Gro√üst√§dte zu beeindrucken. K√∂ln war immer reich, aber auch provinziell.",
            images: [
                { url: "https://images.unsplash.com/photo-1571115764595-644a1f56a55c?w=400", title: "K√∂lner Dom" },
                { url: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400", title: "Dom Innenraum" }
            ]
        },
        {
            id: 3,
            title: "Altstadt",
            subtitle: "Macht, Rebellion und eine gro√üe Liebesgeschichte",
            photoChallenge: "Fotografiert euch am historischen Rathaus und stellt eine romantische Szene nach: Eine Person kniet, eine steht stolz daneben.",
            mainText: "Der Rathaus-Turm zeigt wichtige Pers√∂nlichkeiten der K√∂lner Geschichte. 1945 zerst√∂rt und wieder aufgebaut. Da auch die Figuren zerst√∂rt waren, w√§hlte eine Kommission neue aus - von √ºber 100 Kandidaten. Alle m√§nnlich.",
            images: [
                { url: "https://images.unsplash.com/photo-1544892504-5ad7a122b56f?w=400", title: "K√∂lner Altstadt" },
                { url: "https://images.unsplash.com/photo-1517840901100-8179e982acb7?w=400", title: "Rheinpromenade" }
            ]
        },
        {
            id: 4,
            title: "Gro√ü St. Martin",
            subtitle: "Romanische Kirche und Klostergeschichte",
            photoChallenge: "Macht ein Foto der imposanten Kircht√ºrme und zeigt dabei mittelalterliche Gebetshaltungen!",
            mainText: "Gro√ü St. Martin ist eine der beeindruckendsten romanischen Kirchen K√∂lns. Der markante Vierungsturm pr√§gt seit dem 12. Jahrhundert die Silhouette der Altstadt.",
            images: [
                { url: "https://images.unsplash.com/photo-1518709268805-4e9042af2e96?w=400", title: "Gro√ü St. Martin" },
                { url: "https://images.unsplash.com/photo-1573052905904-34ad8c27f0d4?w=400", title: "Altstadt Panorama" }
            ]
        },
        {
            id: 5,
            title: "Fischmarkt",
            subtitle: "Handel, Handwerk und B√ºrgerstolz",
            photoChallenge: "Zeigt mit euren H√§nden, wie mittelalterliche H√§ndler ihre Waren pr√§sentiert haben - seid kreativ mit Gesten!",
            mainText: "Der Fischmarkt war im Mittelalter das kommerzielle Herz K√∂lns. Hier wurde nicht nur Fisch verkauft, sondern alle wichtigen Handelsg√ºter der Region.",
            images: [
                { url: "https://images.unsplash.com/photo-1578916171728-46686eac8d58?w=400", title: "Alter Markt K√∂ln" },
                { url: "https://images.unsplash.com/photo-1574790398664-0cb3c99c3711?w=400", title: "K√∂lner H√§user" }
            ]
        }
    ];

    // Simple notification function
    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = 'notification ' + (type === 'error' ? 'error' : '');
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
    }

    // Generate share URL immediately
    function generateShareUrl() {
        const url = window.location.href.split('?')[0] + '?tour=' + appData.tourId;
        document.getElementById('shareUrl').textContent = url;
    }

    // Copy URL function
    function copyUrl() {
        const shareUrl = document.getElementById('shareUrl').textContent;
        if (navigator.clipboard) {
            navigator.clipboard.writeText(shareUrl).then(() => {
                showNotification('URL kopiert! üìã');
            });
        } else {
            showNotification('URL: ' + shareUrl);
        }
    }

    // Show tab function
    function showTab(tabName) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        
        // Show selected tab
        document.getElementById(tabName).classList.add('active');
        event.target.classList.add('active');
        
        // Update ranking if ranking tab
        if (tabName === 'ranking') {
            updateRanking();
        }
    }

    // Team selection
    function selectTeam(teamId, teamName, element) {
        appData.selectedTeam = teamId;
        appData.teamName = teamName;
        
        // Update UI
        document.querySelectorAll('.team-option').forEach(option => option.classList.remove('selected'));
        element.classList.add('selected');
        document.getElementById('teamSelector').style.display = 'none';
        
        showNotification('Team ausgew√§hlt! üéâ');
        saveState();
    }

    // Start tour
    function startTour() {
        if (!appData.selectedTeam) {
            showNotification('Bitte w√§hle zuerst ein Team aus!', 'error');
            return;
        }
        showTab('stations');
        document.querySelector('[onclick="showTab(\'stations\')"]').classList.add('active');
        showNotification('Tour gestartet! üöÄ');
    }

    // Generate stations
    function generateStations() {
        const container = document.getElementById('stationsList');
        container.innerHTML = '';
        
        stations.forEach(station => {
            const isCompleted = appData.completedStations.includes(station.id);
            const card = document.createElement('div');
            card.className = 'station-card' + (isCompleted ? ' completed' : '');
            card.onclick = () => toggleStation(station.id);
            
            const imagesHtml = station.images.map(img => 
                `<div class="gallery-item">
                    <img src="${img.url}" alt="${img.title}" class="gallery-image">
                    <small>${img.title}</small>
                </div>`
            ).join('');
            
            card.innerHTML = `
                <div class="station-header">
                    <div class="station-number ${isCompleted ? 'completed' : ''}">${station.id}</div>
                    <div style="flex: 1;">
                        <div class="station-title">${station.title}</div>
                        <div class="station-subtitle">${station.subtitle}</div>
                    </div>
                </div>
                <div class="station-details" id="details-${station.id}">
                    <div class="detail-section">
                        <h4>üìñ Geschichte</h4>
                        <p>${station.mainText}</p>
                    </div>
                    
                    <div class="detail-section">
                        <h4>üñºÔ∏è Bildergalerie</h4>
                        <div class="image-gallery">${imagesHtml}</div>
                    </div>

                    <div class="photo-challenge">
                        <h4>üì∏ KI-Foto-Challenge</h4>
                        <p>${station.photoChallenge}</p>
                        
                        <div class="photo-upload-area" onclick="selectPhoto(${station.id})" id="upload-${station.id}">
                            üì∑ Hier klicken zum Foto machen/ausw√§hlen<br>
                            <small>KI bewertet automatisch</small>
                        </div>
                        
                        <input type="file" class="file-input" id="file-${station.id}" accept="image/*" capture="environment" onchange="handlePhoto(${station.id}, event)">
                        
                        <div class="ai-rating hidden" id="rating-${station.id}">
                            <div class="rating-score" id="score-${station.id}">0</div>
                            <div class="rating-text">KI-Bewertung abgeschlossen!</div>
                        </div>
                    </div>

                    <button class="btn" onclick="completeStation(${station.id})" id="btn-${station.id}" ${isCompleted ? 'disabled' : ''}>
                        ${isCompleted ? '‚úÖ Station abgeschlossen' : 'üèÅ Station abschlie√üen'}
                    </button>
                </div>
            `;
            
            container.appendChild(card);
        });
    }

    // Toggle station details
    function toggleStation(stationId) {
        const details = document.getElementById('details-' + stationId);
        details.classList.toggle('active');
    }

    // Select photo
    function selectPhoto(stationId) {
        document.getElementById('file-' + stationId).click();
    }

    // Handle photo upload
    function handlePhoto(stationId, event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const uploadArea = document.getElementById('upload-' + stationId);
            uploadArea.classList.add('has-photo');
            uploadArea.innerHTML = `
                <img src="${e.target.result}" class="photo-preview" alt="Uploaded photo">
                <p>üì∑ Foto hochgeladen! KI analysiert...</p>
            `;

            // Simulate AI rating
            setTimeout(() => {
                const score = 50 + Math.random() * 40;
                const finalScore = Math.round(score);
                
                const ratingDiv = document.getElementById('rating-' + stationId);
                ratingDiv.classList.remove('hidden');
                document.getElementById('score-' + stationId).textContent = finalScore;
                
                appData.totalScore += finalScore;
                document.getElementById('totalScore').textContent = appData.totalScore;
                updateProgress();
                
                showNotification(`KI-Bewertung: ${finalScore} Punkte! ü§ñ`);
                saveState();
            }, 2000);
        };
        
        reader.readAsDataURL(file);
    }

    // Complete station
    function completeStation(stationId) {
        if (appData.completedStations.includes(stationId)) return;
        
        appData.completedStations.push(stationId);
        
        const btn = document.getElementById('btn-' + stationId);
        btn.disabled = true;
        btn.textContent = '‚úÖ Station abgeschlossen';
        btn.style.background = '#6b7280';
        
        const card = btn.closest('.station-card');
        card.classList.add('completed');
        card.querySelector('.station-number').classList.add('completed');
        
        updateProgress();
        showNotification('Station abgeschlossen! üèÅ');
        
        if (appData.completedStations.length === stations.length) {
            showNotification('üéâ Tour abgeschlossen!');
            setTimeout(() => showTab('ranking'), 2000);
        }
        
        saveState();
    }

    // Update progress
    function updateProgress() {
        const progress = (appData.completedStations.length / stations.length) * 100;
        document.getElementById('progressBar').style.width = progress + '%';
    }

    // Update ranking
    function updateRanking() {
        const teams = [
            { id: 'red', name: 'üî¥ Team R√∂mer', score: appData.selectedTeam === 'red' ? appData.totalScore : Math.floor(Math.random() * 300) + 100 },
            { id: 'blue', name: 'üîµ Team Gaffeln', score: appData.selectedTeam === 'blue' ? appData.totalScore : Math.floor(Math.random() * 300) + 100 },
            { id: 'green', name: 'üü¢ Team Hanseat', score: appData.selectedTeam === 'green' ? appData.totalScore : Math.floor(Math.random() * 300) + 100 },
            { id: 'yellow', name: 'üü° Team Modern', score: appData.selectedTeam === 'yellow' ? appData.totalScore : Math.floor(Math.random() * 300) + 100 }
        ];
        
        teams.sort((a, b) => b.score - a.score);
        
        const rankingList = document.getElementById('rankingList');
        rankingList.innerHTML = '';
        
        teams.forEach((team, index) => {
            const isUserTeam = team.id === appData.selectedTeam;
            const rankItem = document.createElement('div');
            rankItem.className = 'team-rank-item' + (isUserTeam ? ' highlight' : '');
            
            let rankClass = '';
            if (index === 0) rankClass = 'gold';
            else if (index === 1) rankClass = 'silver';
            else if (index === 2) rankClass = 'bronze';
            
            rankItem.innerHTML = `
                <div class="rank-position ${rankClass}">${index + 1}</div>
                <div style="flex: 1;">
                    <strong>${team.name}</strong>
                    <div style="color: #6b7280; font-size: 0.9rem;">${team.score} Punkte</div>
                </div>
                ${isUserTeam ? '<div style="color: #f59e0b;">üë§</div>' : ''}
            `;
            
            rankingList.appendChild(rankItem);
        });
    }

    // Send message
    function sendMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        if (!message) return;
        
        const chatContainer = document.getElementById('chatContainer');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'chat-message own';
        messageDiv.innerHTML = `
            <strong>${appData.userName}:</strong> ${message}
            <span style="float: right; font-size: 0.8rem;">${new Date().toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'})}</span>
        `;
        
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
        input.value = '';
        
        // Store in localStorage for simple sharing
        const messages = JSON.parse(localStorage.getItem('chat_' + appData.tourId) || '[]');
        messages.push({
            userName: appData.userName,
            message: message,
            timestamp: Date.now()
        });
        localStorage.setItem('chat_' + appData.tourId, JSON.stringify(messages));
    }

    // Save state
    function saveState() {
        localStorage.setItem('appData', JSON.stringify(appData));
    }

    // Load state
    function loadState() {
        const saved = localStorage.getItem('appData');
        if (saved) {
            const savedData = JSON.parse(saved);
            appData = {...appData, ...savedData};
            
            // Update UI
            document.getElementById('totalScore').textContent = appData.totalScore;
            updateProgress();
            
            if (appData.selectedTeam) {
                const teamOptions = document.querySelectorAll('.team-option');
                teamOptions.forEach(option => {
                    if (option.textContent.includes(appData.teamName)) {
                        option.classList.add('selected');
                    }
                });
                document.getElementById('teamSelector').style.display = 'none';
            }
        }
    }

    // Initialize app
    function init() {
        console.log('Initializing simple app...');
        
        // Check for tour ID in URL
        const urlParams = new URLSearchParams(window.location.search);
        const tourId = urlParams.get('tour');
        if (tourId) {
            appData.tourId = tourId;
            document.getElementById('currentTourId').textContent = tourId;
        }
        
        generateShareUrl();
        loadState();
        generateStations();
        
        // Set up chat input
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        console.log('App initialized successfully!');
    }

    // Start app when page loads
    document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
